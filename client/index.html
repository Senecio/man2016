<html>
<head>
    <meta charset="utf-8">
    <title>是男人就坚持20秒</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" >
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="fullscreen" content="true"/>
    <meta name="screen-orientation" content="portrait"/>    
    <meta name="x5-fullscreen" content="true"/>
    <meta name="360-fullscreen" content="true"/>
    <meta name="browsermode" content="application">
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="Shortcut Icon" href="favicon.ico" type="image/x-icon" />
    <style>
        * {
            margin: 0;
            padding: 0;
            border: 0;
        }
        body{
            background-image: url(images/banner.jpg);
        }
    </style>
    <script src="./socket.io/socket.io.js"></script>
    <script src="./js/libs/howler.min.js"></script>
    <script src="./js/libs/screenfull.min.js"></script>
    <script src="./js/Net.js"></script>
    <script src="./js/Engine.js"></script>
    <script src="./js/Game.js"></script>
    <script src="./js/Table.js"></script>
    <script src="./js/Map.js"></script>
    <script src="./js/MotionBlur.js"></script>
    <script src="./js/UIController.js"></script>
    <script src="./js/UIJoystick.js"></script>
    <script src="./js/CameraFllow.js"></script>
    <script src="./js/PlayerShip.js"></script>
    <script src="./js/Buff.js"></script>
    <script src="./js/BulletBatch.js"></script>
    <script src="./js/Notify.js"></script>
    <script>

    
    function ShowLoginUI(show)
    {
        var ui = document.getElementById('UI_Login');
        if (ui) {
            ui.style.display = show ? "block" : "none";
        }
    }
        
    function ShowGameContent(show)
    {
        var element = document.getElementById('GameContent');
        if (element) {
            element.style.display = show ? "block" : "none";
        }
    }
        
    function Start()
    {
        function FilpUILogin(){
            var a = 0;
            var uiLogin = document.getElementById('UI_Login');
            var handler = setInterval(function() {
                a += 5;
                if(a > 90) {
                    StartGame();
                    clearInterval(handler);
                }else{
                    uiLogin.style.transform = "rotateY(" + a + "deg)";
                }
            }, 1000/30);
        }
        
        function StartGame(){
            var canvas = document.getElementById('GameCanvas');
            game = new Game();
            game.Init(canvas, net);
        }
        
        init_window_innerHeight = window.innerHeight;
        
        var net = new Net();
        net.Start();
        
        // Checks if the nick chosen contains valid alphanumeric characters (and underscores).
        function validNick(nickName) {
            return nickName !== "";
        }
        
        var btnStart = document.getElementById('startButton');
        var nickErrorText = document.getElementById('nickErrorText');
        var nickNameInput = document.getElementById('nickNameInput');
        
        if (btnStart) {
            btnStart.onclick = function () {
                if (nickErrorText) {
                    // Checks if the nick is valid.
                    if (validNick(nickNameInput.value)) {
                        nickErrorText.style.opacity = 0;
                        btnStart.onclick = function() {}
                        FilpUILogin();
                    } else {
                        nickErrorText.style.opacity = 1;
                    }
                }
            };
        }
        
        if (nickErrorText) {
            nickErrorText.onclick = function (e) {
                if (nickNameInput) {
                    nickNameInput.select();
                }
                e.preventDefault();
                nickErrorText.style.opacity=0;
            };
        }
    }
    </script>
</head>
<body onload="Start()">
    <div id="GameContent" style="width:320px; margin:0 auto; display:none;">
    <canvas id='GameCanvas' width="320px" height="480px" style="background-color: #fff;position:absolute;top:0px;" oncontextmenu="return false">
        <p>Can't load HTML 5 canvas: is your browser up to date?</p>
    </canvas>
    </div>
    <div id="UI" style="position:relative; display:block; -webkit-perspective:300; perspective:300;">
        <div id="UI_Login" style="display:block; width:device-width; max-width:320px; margin:0 auto; border-radius: 10px; background-color: #222; padding: 10px; margin-top: 50px; border:2px; border-color:#fff; border-style : solid; transform-style: preserve-3d;">
            <h1 style="text-align:center; margin-top: 32px; font-size: 30px; color: #fff">是男人就坚持20秒</h1>
            <h2 style="text-align:right; font-size: 16px; color: #fff">真男人系列&#8482</h2>
            <input id="nickNameInput" type="email" placeholder="Nick Name" style="border: solid 1px #CCCCCC; border-radius: 4px; width: 100%; padding: 10px; margin-bottom: 10px; margin-top: 10px; font-size: 18px;"  maxlength="12">
            <h2 id="nickErrorText" style="position:relative; top:-42px; text-align:center; font-size: 18px; color: #f11; opacity:0">请在此输入昵称</h2>
            <button id="startButton" type="submit" style="border-radius: 4px; width: 100%; padding: 10px; font-size: 18px; margin-bottom: 50px; background-color:#ccc">进入</button>
        </div>
    </div>
    <h1>hello!</h1>
    <script>
    /*
    var new_element_N=document.createElement("style"); 
    new_element_N.innerHTML = '#drager {' +
    '   position: fixed;' +
    '   width: 35px;' +
    '   height: 35px;' +
    '   background-color: rgba(0, 0, 0, 0.2);' +
    '   z-index: 10000;' +
    '   cursor: pointer;' +
    '   top: 0px;' +
    '   left: 0px;' +
    '   border-radius: 30%;' +
    '   padding: 6px;' +
    ' }' +
    ' ' +
    ' #drager>div {' +
    '   border-radius: 50%;' +
    '   width: 100%;' +
    '   height: 100%;' +
    '   background-color: rgba(0, 0, 0, 0.3);' +
    '   transition: all 0.2s;' +
    '  -webkit-transition: all 0.2s;' +
    '  -moz-transition: all 0.2s;' +
    '  -o-transition: all 0.2s;' +
    ' }' +
    ' #drager:hover>div{' +
    '   background-color: rgba(0, 0, 0, 0.6);' +
    ' } ';
      document.body.appendChild(new_element_N);
      new_element_N=document.createElement('div'); 
      new_element_N.setAttribute("id","drager");
      new_element_N.style.top="100px";
      new_element_N.style.left="100px";
      new_element_N.innerHTML = ' <div></div>' ;
      document.body.appendChild(new_element_N);
    // 
    // 
    var posX;
    var posY;   
    var screenWidth =document.documentElement.clientWidth;
    var screenHeight = document.documentElement.clientHeight;  
    var fdiv = document.getElementById("drager"); 
    fdiv.onmousedown=function(e)
    { 
      screenWidth =document.documentElement.clientWidth;
      screenHeight = document.documentElement.clientHeight;  
      if(!e){ e = window.event; } //IE
      posX = e.clientX - parseInt(fdiv.style.left);
      posY = e.clientY - parseInt(fdiv.style.top);
      document.onmousemove = mousemove;      
    }
    document.onmouseup = function()//释放时自动贴到最近位置
    {
      document.onmousemove = null;
      if((parseInt(fdiv.style.top)+parseInt(fdiv.clientHeight)/2)<=(screenHeight/2)){//在上半部分
        if((parseInt(fdiv.style.left)+parseInt(fdiv.clientWidth)/2)<=(screenWidth/2)){//在左半部分
          if((parseInt(fdiv.style.top)+parseInt(fdiv.clientHeight)/2)<=(parseInt(fdiv.style.left)+parseInt(fdiv.clientWidth)/2)){//靠近上方
            fdiv.style.top="0px";
          }else{//靠近左边
            fdiv.style.left="0px";
          }
        }else{//在右半部分
          if((parseInt(fdiv.style.top)+parseInt(fdiv.clientHeight)/2)<=(screenWidth-(parseInt(fdiv.style.left)+parseInt(fdiv.clientWidth)/2)) ){//靠近上方
            fdiv.style.top="0px";
          }else{//靠近右边
            fdiv.style.left=(screenWidth-parseInt(fdiv.clientWidth))+"px";
          } 
        }
      }else{ //下半部分
         if((parseInt(fdiv.style.left)+parseInt(fdiv.clientWidth)/2)<=(screenWidth/2)){//在左半部分
          if( (screenHeight-(parseInt(fdiv.style.top)+parseInt(fdiv.clientHeight)/2))<=(parseInt(fdiv.style.left)+parseInt(fdiv.clientWidth)/2)){//靠近下方
            fdiv.style.top=(screenHeight-parseInt(fdiv.clientHeight))+"px";
          }else{//靠近左边
            fdiv.style.left="0px";
          }
        }else{//在右半部分
          if( (screenHeight-(parseInt(fdiv.style.top)+parseInt(fdiv.clientHeight)/2))<=(screenWidth-(parseInt(fdiv.style.left)+parseInt(fdiv.clientWidth)/2)) ){//靠近上方
            fdiv.style.top=(screenHeight-parseInt(fdiv.clientHeight))+"px";
          }else{//靠近右边
            fdiv.style.left=(screenWidth-parseInt(fdiv.clientWidth))+"px";
          } 
        }
      } 
    }
    function mousemove(ev)
    {
      if(ev==null){ ev = window.event;}//IE
      if((ev.clientY - posY)<=0){//超过顶部
         fdiv.style.top="0px";
      }else if((ev.clientY - posY) >(screenHeight-parseInt(fdiv.clientHeight))){//超过底部
        fdiv.style.top=(screenHeight-parseInt(fdiv.clientHeight))+"px";
      }else{
        fdiv.style.top = (ev.clientY - posY) + "px";
      }
       
       if((ev.clientX- posX)<=0){//超过左边
         fdiv.style.left="0px";
      }else if((ev.clientX - posX) >(screenWidth-parseInt(fdiv.clientWidth))){//超过右边
        fdiv.style.left=(screenWidth-parseInt(fdiv.clientWidth))+"px";
      }else{
        fdiv.style.left = (ev.clientX - posX) + "px";
      }
      // console.log( posX +" "+ fdiv.style.left);
       
    }
    window.onload = window.onresize = function() { //窗口大小改变事件
      screenWidth =document.documentElement.clientWidth;
      screenHeight = document.documentElement.clientHeight;  
      if( (parseInt(fdiv.style.top)+parseInt(fdiv.clientHeight))>screenHeight){//窗口改变适应超出的部分
         fdiv.style.top=(screenHeight-parseInt(fdiv.clientHeight))+"px";
      }  
      if( (parseInt(fdiv.style.left)+parseInt(fdiv.clientWidth))>screenWidth){//窗口改变适应超出的部分
         fdiv.style.left=(screenWidth-parseInt(fdiv.clientWidth))+"px";
      }  
      document.onmouseup.apply()
    };
    fdiv.addEventListener('touchstart', fdiv.onmousedown, false);  
    fdiv.addEventListener('touchmove', function(event) {
            // 如果这个元素的位置内只有一个手指的话
            if (event.targetTouches.length == 1) {
                event.preventDefault();// 阻止浏览器默认事件，重要 
              var touch = event.targetTouches[0]; 
              if((touch.pageY)<=0){//超过顶部
                fdiv.style.top="0px";
              }else if(touch.pageY>(screenHeight-parseInt(fdiv.clientHeight))){//超过底部
                fdiv.style.top=(screenHeight-parseInt(fdiv.clientHeight))+"px";
              }else{
                fdiv.style.top = (touch.pageY-parseInt(fdiv.clientHeight)/2) + "px";
              }
               
              if(touch.pageX<=0){//超过左边
                fdiv.style.left="0px";
              }else if( touch.pageX >(screenWidth-parseInt(fdiv.clientWidth))){//超过右边
                fdiv.style.left=(screenWidth-parseInt(fdiv.clientWidth))+"px";
              }else{
                fdiv.style.left = (touch.pageX-parseInt(fdiv.clientWidth)/2) + "px";
              }
            }
          }, false); 
    fdiv.addEventListener('touchend', document.onmouseup , false);       
    fdiv.ondblclick=function(){//双击事件可能在手机端浏览器会与网页缩放事件冲突
      alert("发挥你们的想象力吧");
    }*/
    </script>
</body>
</html>
